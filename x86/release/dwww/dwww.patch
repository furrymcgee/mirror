From 8ac33fc55e4727a71bc2c1d0c6c85ac86a209d23 Mon Sep 17 00:00:00 2001
From: furrymcgee <furrymcgee@lippydanger.jumpingcrab.com>
Date: Tue, 13 Apr 2021 20:00:00 +0200
Subject: [PATCH] index on (no branch): 3c337f9 1.13.4+nmu3

---
 common.mk                             |  40 +++---
 data/Makefile                         |   2 +-
 data/apache.conf                      |  18 ++-
 data/dwww.css.in                      |   6 +-
 data/img/Makefile                     |   7 +-
 data/img/dwww.svg                     | 182 ++++++++++++++++++++++++++
 data/mozilla/Makefile                 |   1 +
 data/mozilla/dwww.xml                 |   6 +-
 data/swish++.conf                     |  21 ++-
 data/templates/dwww-convert.dir.start |   4 +-
 data/templates/dwww-convert.start     |   4 +-
 data/templates/dwww-find.start        |  14 +-
 data/templates/dwww.template          |  24 ++--
 data/templates/man-begins-with.start  |   9 +-
 data/templates/man-in-section.start   |   9 +-
 data/templates/man-index.start        |   9 +-
 data/templates/menu.all.start         |  14 +-
 data/templates/menu.errors.start      |   4 +-
 data/templates/menu.nosections        |  14 +-
 data/templates/menu.single.start      |  14 +-
 debian/rules                          |   2 +-
 perl/Debian/Dwww/Common.pm            |  44 ++++---
 perl/Debian/Dwww/Utils.pm             |  29 ++--
 scripts/dwww-build                    |   8 +-
 scripts/dwww-build-menu               |  11 +-
 scripts/dwww-find                     |   2 +-
 scripts/dwww-index++                  |  17 +--
 scripts/dwww-refresh-cache            |   4 +-
 scripts/dwww.cgi                      |  10 +-
 src/dwww-txt2html.c                   |   2 +-
 30 files changed, 356 insertions(+), 175 deletions(-)
 create mode 100644 data/img/dwww.svg

diff --git dwww/common.mk dwww/common.mk
index 93af614..854c33b 100644
--- dwww/common.mk
+++ dwww/common.mk
@@ -10,14 +10,14 @@ override PACKAGE  := dwww
 PATH            := /usr/bin:/usr/sbin:/bin:/sbin:$(PATH)
 
 # build abstraction
-install_file    := install -p -o root -g root -m 644
-install_script  := install -p -o root -g root -m 755
-install_dir     := install -d -o root -g root -m 755
+install_file    := install -p -o $(shell id -u) -g $(shell id -g) -m 644
+install_script  := install -p -o $(shell id -u) -g $(shell id -g) -m 755
+install_dir     := install -d -o $(shell id -u) -g $(shell id -g) -m 755
 install_link    := ln -sf
 compress        := gzip -9f
 
 prefix          := /usr
-etcdir          := /etc
+etcdir          := /etc/httpd/conf.d
 bindir          := $(prefix)/bin
 sbindir         := $(prefix)/sbin
 mandir          := $(prefix)/share/man
@@ -30,15 +30,15 @@ libdir          := /var/lib/$(PACKAGE)
 nlsdir          := $(prefix)/share/locale
 cachedir        := /var/cache/$(PACKAGE)
 webdocrootdir   := /var/www
-webcgidir       := $(prefix)/lib/cgi-bin
+webcgidir       := /srv/www/cgi-bin
 applicationsdir := $(prefix)/share/applications
 
 PERL            = /usr/bin/perl
 ifndef COMPILER_FLAGS_ALREADY_SET
 export CC       ?= gcc
-export CPPFLAGS += -DVERSION='"$(VERSION)"'
+export CPPFLAGS += -DVERSION='"$(VERSION)"' -DMAXINT=INT_MAX
 export CFLAGS   += -Wall -Wextra -Wstrict-prototypes -Wmissing-prototypes -Werror -g $(shell getconf LFS_CFLAGS)
-export LDFLAGS  +=
+export LDFLAGS  += -L /usr/lib/i386-linux-gnu
 export LIBS     += -lpub
 export COMPILER_FLAGS_ALREADY_SET := 1
 endif
@@ -55,17 +55,11 @@ ifndef VERSION
 ###  DATE_EN           := $(shell LC_ALL=C date --date="$(DATE)" '+%d %B, %Y')
   export VERSION DATE DATE_EN
 
-  ifndef DISTIBUTOR
-    ifneq (,$(findstring ubuntu,$(VERSION)))
-      DISTRIBUTOR     := Ubuntu
-    else
-      DISTRIBUTOR     := `lsb_release -is`
-    endif
-  endif
-  ifneq (Ubuntu,$(DISTRIBUTOR))
-    DISTRIBUTOR   := Debian
+  DISTRIBUTOR     ?= dwww
+  ifndef DISTRIBUTOR
+      DISTRIBUTOR:=$(shell dpkg-vendor --query vendor | tr "[:upper:]" "[:lower:]")
   endif
-  distributor     := $(shell echo $(DISTRIBUTOR) | tr "[:upper:]" "[:lower:]")
+  distributor     ?= $(shell echo $(DISTRIBUTOR) | tr "[:upper:]" "[:lower:]")
 
   export DISTRIBUTOR distributor
   unexport CDPATH
@@ -130,15 +124,15 @@ define install
   done;                                                             \
   [ -n "$$files" ] ||                                               \
     echo "installing dir    $(ddirshort)$$dir";                     \
-  $(install_dir) "$(DESTDIR)/$$dir";                                \
+  $(install_dir) "$(DESTDIR)//$$dir";                                \
   for file in $$files; do                                           \
       [ -n "$$bfile" ] && tgt="$$dir/$$bfile"  ||                   \
         tgt="$$dir/`basename "$$file"`";                            \
       echo "installing $$what $(ddirshort)$$tgt";                   \
-      $$prg "$$file" "$(DESTDIR)/$$tgt";                            \
+      $$prg "$$file" "$(DESTDIR)//$$tgt";                            \
       if [ "$$doCompress" -eq 1 ] ; then                            \
         echo "compressing file  $(ddirshort)$$tgt";                 \
-        $(compress) "$(DESTDIR)/$$tgt";                             \
+        $(compress) "$(DESTDIR)//$$tgt";                             \
       fi;                                                           \
   done;
 endef
@@ -148,9 +142,9 @@ define install_links
   $(AT) set -e;                                                    \
   for file in $2; do                                               \
     echo "installing link   $(ddirshort)$$file";                   \
-    $(install_dir) $(DESTDIR)/`dirname "$$file"`;                  \
-    rm -f "$(DESTDIR)/$$file";                                     \
-    $(install_link) "$1" "$(DESTDIR)/$$file";                      \
+    $(install_dir) $(DESTDIR)//`dirname "$$file"`;                  \
+    rm -f "$(DESTDIR)//$$file";                                     \
+    $(install_link) "$1" "$(DESTDIR)//$$file";                      \
   done;
 endef
 
diff --git dwww/data/Makefile dwww/data/Makefile
index aa2612a..b7eea0a 100644
--- dwww/data/Makefile
+++ dwww/data/Makefile
@@ -12,5 +12,5 @@ all-local: $(generated) | $(bdir)
 
 install-local:
 	$(call install,$(pkgsharedir),$(templatefiles)) 
-	$(call install,$(etcdir)/apache2/conf-available/dwww.conf,apache.conf,notdir)
+	$(call install,$(etcdir)/dwww.conf,apache.conf,notdir)
 	$(call install,$(applicationsdir),dwww.desktop) 
diff --git dwww/data/apache.conf dwww/data/apache.conf
index 5965ace..dbe7624 100644
--- dwww/data/apache.conf
+++ dwww/data/apache.conf
@@ -1,21 +1,27 @@
 # Dwww configuration file for apache 2.4 or later
+
+# debian vendorlib
+SetEnv PERL5LIB /usr/share/perl5/
+
 <IfModule mod_alias.c>
 	Alias /dwww /var/www/dwww
+	# symbolic links and aliases may be used to point to other locations.
+	Alias /usr/local/share/doc /usr/local/share/doc
 </IfModule>
 
+<Directory "/usr/local/share/doc">
+	Require all granted
+</Directory>
+
 <Directory "/var/www/dwww">
 	<IfModule mod_authz_host.c>
-		Require local
-		# Require ip 192.0.2.0/24
-		# Require ip 2001:db8::a00:20ff:fea7:ccea/10
+		Require all granted
 	</IfModule>
 </Directory>
 
 <Location "/cgi-bin/dwww">
 	<IfModule mod_authz_host.c>
-		Require local
-		# Require ip 192.0.2.0/24
-		# Require ip 2001:db8::a00:20ff:fea7:ccea/10
+		Require all granted
 	</IfModule>
 </Location>
 
diff --git dwww/data/dwww.css.in dwww/data/dwww.css.in
index e9408a5..c5f8167 100644
--- dwww/data/dwww.css.in
+++ dwww/data/dwww.css.in
@@ -10,7 +10,7 @@
 */
 
 body	{ font-family:Verdana, Geneva, "Bitstream Vera Sans", "DejaVu Sans", sans-serif;
-          margin:20px; background-color:#FFEEDD; }
+          margin:20px; }
 
 p,li	{ margin:0 0 0.5em 0; color:#404040; }
 
@@ -21,7 +21,7 @@ a:hover   { color:#AA0000; background-color:#EEEEEE; }
 
 a.nohref  { color:#000099; text-decoration:inherit; background-color:inherit; }
 
-table { border-collapse:collapse; border:0; background:#FFF9F0;
+table { border-collapse:collapse; border:0;
         margin:1em auto 1em auto; } /* centers them if < 100% */
 table.wide { width:100% }
 th, td     { border:#FFEEDD 1px solid; padding:1px 5px 2px 5px; vertical-align:top; }
@@ -65,7 +65,7 @@ hr.w15c { text-align:center; width:15%; }
 /* dwww template formatting (req. kv5r mods in templates) */
 form, input { margin:0.25em auto; }
 div#head    { min-height:45px; _height:45px;  /* ugly IE6 hack */
-              background: url('/dwww/#distributor#.png') no-repeat scroll top left; }
+              background: url('/dwww/#distributor#.svg') no-repeat scroll top left; }
 div#head h1 { padding:10px 0 0 150px; text-align:center; }
 div#men p, div#men a { text-align:center;
  border-top:1px solid #996633; border-bottom:1px solid #996633; }
diff --git dwww/data/img/Makefile dwww/data/img/Makefile
index 8cb959e..51f5739 100644
--- dwww/data/img/Makefile
+++ dwww/data/img/Makefile
@@ -5,8 +5,11 @@ ALL_TARGET  :=
 SUBDIRS     :=
 include ../../common.mk
 
-templatefiles  := $(distributor).png
+templatefiles  := $(distributor).svg
 
-install-local:
+install-local: $(templatefiles)
 	$(call install,$(pkgsharedir),$(templatefiles)) 
 	$(call install,$(pxmpsharedir),dwww-gnome-touristinfo.png)
+
+%.png: %.svg
+	convert $< $@
diff --git dwww/data/img/dwww.svg dwww/data/img/dwww.svg
new file mode 100644
index 0000000..c9adab6
--- /dev/null
+++ dwww/data/img/dwww.svg
@@ -0,0 +1,182 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- https://upload.wikimedia.org/wikipedia/commons/7/75/441-dog-face.svg -->
+<!-- Generator: Adobe Illustrator 21.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
+<svg version="1.1" id="Icons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
+	 viewBox="0 0 48 48" style="enable-background:new 0 0 48 48;" xml:space="preserve">
+<style type="text/css">
+	.st0{opacity:0.15;fill:#45413C;}
+	.st1{fill:#FF6196;}
+	.st2{fill:#FF87AF;}
+	.st3{fill:none;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st4{fill:#FFE500;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st5{fill:#FFE500;}
+	.st6{fill:#EBCB00;}
+	.st7{fill:#EBCB00;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st8{fill:#FFF48C;}
+	.st9{fill:#FFCCDD;stroke:#FFB0CA;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st10{fill:#FFB0CA;stroke:#FF87AF;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st11{opacity:0.7;fill:#FFE5EE;}
+	.st12{fill:#009FD9;}
+	.st13{fill:#00B8F0;}
+	.st14{fill:#656769;}
+	.st15{fill:#87898C;}
+	.st16{fill:#FF6242;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st17{fill:#4AEFF7;}
+	.st18{fill:#00DFEB;}
+	.st19{fill:#A6FBFF;}
+	.st20{fill:#FFFFFF;}
+	.st21{fill:#E5F8FF;}
+	.st22{fill:#E5F8FF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st23{fill:#FFE500;stroke:#EBCB00;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st24{fill:#BDBEC0;}
+	.st25{fill:#4ACFFF;}
+	.st26{fill:#E8F4FA;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st27{fill:#80DDFF;}
+	.st28{fill:#009FD9;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st29{fill:#B8ECFF;}
+	.st30{fill:#4ACFFF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st31{fill:#B8ECFF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st32{fill:#FFFACF;}
+	.st33{fill:#FFF48C;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st34{fill:#BF8256;}
+	.st35{fill:#DEA47A;}
+	.st36{fill:#656769;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st37{fill:#FF8A14;}
+	.st38{fill:#FFAA54;}
+	.st39{fill:#EB6D00;}
+	.st40{fill:#627B8C;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st41{fill:#FFFFFF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st42{fill:#E0366F;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st43{fill:#FF87AF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st44{fill:#E0366F;}
+	.st45{fill:#FF6196;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st46{fill:#525252;}
+	.st47{fill:#DEBB7E;}
+	.st48{fill:#F0D5A8;}
+	.st49{fill:#DAEDF7;}
+	.st50{fill:#F7E5C6;}
+	.st51{fill:#DEBB7E;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st52{fill:#FFF5E3;}
+	.st53{fill:#00F5BC;}
+	.st54{fill:#FFB0CA;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st55{fill:#8CFFE4;}
+	.st56{fill:#00DBA8;}
+	.st57{fill:#87898C;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st58{fill:#FF6242;}
+	.st59{fill:#FF866E;}
+	.st60{fill:#F0F0F0;}
+	.st61{fill:#BDBEC0;stroke:#45413C;stroke-width:1.0064;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st62{fill:#947746;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st63{fill:#B89558;}
+	.st64{fill:#E04122;}
+	.st65{fill:#C0DCEB;}
+	.st66{fill:#E8F4FA;}
+	.st67{fill:#00B8F0;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st68{fill:#80DDFF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st69{fill:#9CEB60;}
+	.st70{fill:#C8FFA1;}
+	.st71{fill:#FFB0CA;}
+	.st72{fill:#FFCCDD;}
+	.st73{fill:#FFE5EE;}
+	.st74{fill:#45413C;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st75{fill:#FFCABF;}
+	.st76{fill:#FFA694;}
+	.st77{fill:#FFA694;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st78{fill:#FFCC99;}
+	.st79{fill:#8CA4B8;}
+	.st80{fill:#ADC4D9;}
+	.st81{fill:#F0D5A8;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st82{fill:#BDBEC0;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st83{fill:#E0E0E0;}
+	.st84{fill:#45413C;}
+	.st85{fill:#E5FEFF;}
+	.st86{fill:#FFFCE5;}
+	.st87{fill:#FFAA54;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st88{fill:#6DD627;}
+	.st89{fill:#46B000;}
+	.st90{fill:#FFE8E0;}
+	.st91{fill:#FFCEBF;}
+	.st92{fill:#FFE8D1;}
+	.st93{fill:#FFF48C;stroke:#4F4B45;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st94{fill:#FFDCD1;stroke:#4F4B45;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st95{fill:none;stroke:#4F4B45;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st96{fill:none;stroke:#4F4B45;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st97{fill:#656769;stroke:#4F4B45;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st98{fill:#87898C;stroke:#4F4B45;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st99{fill:#C0DCEB;stroke:#4F4B45;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st100{fill:#FFA694;stroke:#4F4B45;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st101{fill:#E04122;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st102{fill:#FFFCE5;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st103{fill:#915E3A;}
+	.st104{fill:none;stroke:#915E3A;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st105{fill:#915E3A;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st106{fill:#FF866E;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st107{fill:#FFF5E3;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st108{fill:#FFDCD1;}
+	.st109{fill:#FFDCD1;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st110{fill:#F0C2A1;}
+	.st111{fill:#FFE3CF;}
+	.st112{fill:#FFFACF;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st113{fill:#DEA47A;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st114{fill:#F0C2A1;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st115{fill:#EB6D00;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st116{fill:#FF8A14;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st117{fill:#D9FDFF;}
+	.st118{fill:#C8FFA1;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st119{fill:#E4FFD1;}
+	.st120{fill:#E0E0E0;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st121{fill:#FFCCDD;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st122{fill:#BF8256;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+	.st123{fill:#C0DCEB;stroke:#45413C;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;}
+</style>
+<g>
+	<path id="XMLID_11645_" class="st47" d="M20.5,7.3c0,0-5.5-2.7-9.7,1.7c-4.2,4.4-2.9,8-5.7,9.7s-4.2,7.5-0.6,9.1
+		c3.6,1.7,6.3,0,6.3,0L20.5,7.3z"/>
+	<path id="XMLID_11644_" class="st48" d="M5,22c2.9-1.8,1.5-5.3,5.7-9.7c2.9-3.1,6.5-2.7,8.4-2.2l1.3-2.8c0,0-5.5-2.7-9.7,1.7
+		c-4.2,4.4-2.9,8-5.7,9.7C3,20,1.7,23.3,2.5,25.6C2.9,24.1,3.9,22.7,5,22z"/>
+	<path id="XMLID_11643_" class="st3" d="M20.5,7.3c0,0-5.5-2.7-9.7,1.7c-4.2,4.4-2.9,8-5.7,9.7s-4.2,7.5-0.6,9.1
+		c3.6,1.7,6.3,0,6.3,0L20.5,7.3z"/>
+	<path id="XMLID_11642_" class="st47" d="M27.5,7.3c0,0,5.5-2.7,9.7,1.7c4.2,4.4,2.9,8,5.7,9.7s4.2,7.5,0.6,9.1
+		c-3.6,1.7-6.3,0-6.3,0L27.5,7.3z"/>
+	<path id="XMLID_11641_" class="st48" d="M43,22c-2.9-1.8-1.5-5.3-5.7-9.7c-2.9-3.1-6.5-2.7-8.4-2.2l-1.3-2.8c0,0,5.5-2.7,9.7,1.7
+		c4.2,4.4,2.9,8,5.7,9.7c2.1,1.3,3.3,4.6,2.5,6.9C45.1,24.1,44.1,22.7,43,22z"/>
+	<path id="XMLID_11640_" class="st3" d="M27.5,7.3c0,0,5.5-2.7,9.7,1.7c4.2,4.4,2.9,8,5.7,9.7s4.2,7.5,0.6,9.1c-3.6,1.7-6.3,0-6.3,0
+		L27.5,7.3z"/>
+	<path id="XMLID_11639_" class="st60" d="M37,18.7c0-6.2-5.9-12-12.5-12h-1.1c-6.5,0-12.5,5.8-12.5,12v1.1c0,0,0,0,0,0
+		c-2.2,1.7-3,4.7-3,7.6c0,5.3,3.9,9,9.5,9h1.9c1.4,1.1,2.7,1.7,4.6,1.7s3.2-0.6,4.6-1.7h1.9c5.6,0,9.5-3.7,9.5-9
+		c0-2.9-0.8-5.9-3-7.6L37,18.7z"/>
+	<path id="XMLID_11558_" class="st20" d="M37,19.8l0-1.2c0-6.2-5.9-12-12.5-12h-1.1c-6.5,0-12.5,5.8-12.5,12v1.1c0,0,0,0,0,0
+		l0.8-2.1c1.9-4.5,6.6-7.9,11.6-7.9h1.1c5.3,0,10.2,3.8,11.9,8.6L37,19.8z"/>
+	<circle id="XMLID_11556_" class="st74" cx="17.1" cy="22.7" r="1.7"/>
+<!--
+	<ellipse id="XMLID_11557_" class="st0" cx="24" cy="44.3" rx="13.1" ry="1.7"/>
+	<ellipse id="XMLID_11555_" class="st1" cx="35.6" cy="29.4" rx="2.1" ry="1"/>
+	<ellipse id="XMLID_11554_" class="st1" cx="12.4" cy="29.4" rx="2.1" ry="1"/>
+-->
+	<path id="XMLID_11553_" class="st47" d="M39,22.4c-0.5-1-1.1-1.9-2-2.6l0-1.2c0-3.9-2.3-7.6-5.7-9.9c-2,1.7-5.6,5.6-5.6,11
+		c0,7.4,6.1,8.1,9.7,6.3C37.4,25.1,38.4,23.8,39,22.4z"/>
+	<path id="XMLID_11552_" class="st48" d="M37,19.8l-0.6-1.4c-1.1-3.3-3.8-6.1-7.1-7.5c0.7-0.9,1.4-1.5,2-2c0,0,0,0,0,0
+		c1.4,1,2.6,2.1,3.7,3.7C37.2,15.7,37,18.4,37,19.8z"/>
+	<path id="XMLID_11551_" class="st3" d="M37,18.7c0-6.2-5.9-12-12.5-12h-1.1c-6.5,0-12.5,5.8-12.5,12v1.1c0,0,0,0,0,0
+		c-2.2,1.7-3,4.7-3,7.6c0,5.3,3.9,9,9.5,9h1.9c1.4,1.1,2.7,1.7,4.6,1.7s3.2-0.6,4.6-1.7h1.9c5.6,0,9.5-3.7,9.5-9
+		c0-2.9-0.8-5.9-3-7.6L37,18.7z"/>
+	<path id="XMLID_11550_" class="st3" d="M39,22.4c-0.5-1-1.1-1.9-2-2.6l0-1.2c0-3.9-2.3-7.6-5.7-9.9c-2,1.7-5.6,5.6-5.6,11
+		c0,7.4,6.1,8.1,9.7,6.3C37.4,25.1,38.4,23.8,39,22.4z"/>
+	<circle id="XMLID_11549_" class="st74" cx="30.9" cy="22.7" r="1.7"/>
+	<path id="XMLID_11548_" class="st14" d="M27.4,29c0,0.9-1.5,2.9-3.4,2.9s-3.4-1.9-3.4-2.9s1.5-1.7,3.4-1.7S27.4,28,27.4,29z"/>
+	<path id="XMLID_11547_" class="st15" d="M24,28.9c1.4,0,2.6,0.4,3.1,1c0.2-0.3,0.3-0.7,0.3-0.9c0-0.9-1.5-1.7-3.4-1.7
+		S20.6,28,20.6,29c0,0.3,0.1,0.6,0.3,0.9C21.4,29.3,22.6,28.9,24,28.9z"/>
+	<path id="XMLID_11546_" class="st3" d="M27.4,29c0,0.9-1.5,2.9-3.4,2.9s-3.4-1.9-3.4-2.9s1.5-1.7,3.4-1.7S27.4,28,27.4,29z"/>
+	<path id="XMLID_11545_" class="st57" d="M19.4,36.4v-2.3c2.2,0,4.6-2.3,4.6-2.3s2.4,2.3,4.6,2.3v2.3c0,0-0.5,2.3-4.6,2.3
+		S19.4,36.4,19.4,36.4z"/>
+	<path class="st59" d="M26.3,35.3c-1.7,0-2.2,0.9-2.3,1c-0.1-0.1-0.5-1-2.3-1c-1.9,0-2,2.1-0.6,4.2c0.7,1,1.8,1.5,2.9,1.5
+		c1.1,0,2.1-0.5,2.9-1.5C28.3,37.5,28.2,35.3,26.3,35.3z"/>
+	<path class="st58" d="M21.7,36.5c1.7,0,2.2,0.9,2.3,1c0.1-0.1,0.5-1,2.3-1c0.8,0,1.3,0.4,1.5,1c0.3-1.3-0.2-2.2-1.5-2.2
+		c-1.7,0-2.2,0.9-2.3,1c-0.1-0.1-0.5-1-2.3-1c-1.3,0-1.7,1-1.5,2.2C20.4,36.9,20.9,36.5,21.7,36.5z"/>
+	<path class="st3" d="M26.3,35.3c-1.7,0-2.2,0.9-2.3,1c-0.1-0.1-0.5-1-2.3-1c-1.9,0-2,2.1-0.6,4.2c0.7,1,1.8,1.5,2.9,1.5
+		c1.1,0,2.1-0.5,2.9-1.5C28.3,37.5,28.2,35.3,26.3,35.3z"/>
+	<line id="XMLID_11544_" class="st3" x1="24" y1="36.3" x2="24" y2="38.1"/>
+	<path id="XMLID_11543_" class="st57" d="M19.4,34.1c-1.1,0-1.7-0.6-1.7-0.6"/>
+	<path id="XMLID_11542_" class="st57" d="M28.6,34.1c1.1,0,1.7-0.6,1.7-0.6"/>
+</g>
+</svg>
diff --git dwww/data/mozilla/Makefile dwww/data/mozilla/Makefile
index ad9547d..fa9a5e7 100644
--- dwww/data/mozilla/Makefile
+++ dwww/data/mozilla/Makefile
@@ -17,6 +17,7 @@ install-local: override ATT := $(AT)
 install-local: override AT  :=
 install-local:
 	$(ATT) $(foreach browserdir,$(browserdirs),$(call install,$(browserdir),$(files)))
+	$(call install,$(pkgsharedir),$(files)) 
 
 update-xml:
 	sed -i~ -e 's#\(base64,\).*\(<\)#\1'"`base64 -w 0 dwww.png`"'\2#' dwww.xml
diff --git dwww/data/mozilla/dwww.xml dwww/data/mozilla/dwww.xml
index 776164e..698c325 100644
--- dwww/data/mozilla/dwww.xml
+++ dwww/data/mozilla/dwww.xml
@@ -2,10 +2,10 @@
 <OpenSearchDescription xmlns="http://a9.com/-/spec/opensearch/1.1/"
                        xmlns:moz="http://www.mozilla.org/2006/browser/search/">
   <ShortName>Dwww</ShortName>
-  <Description>Debian Documentation on localhost</Description>
+  <Description>Documentation on dwww</Description>
   <InputEncoding>UTF-8</InputEncoding>
   <Image width="16" height="16">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AIJBygzOpp08QAAAbZJREFUOMudks1qU1EUhb917m0TSBMk0MaqGCI4EQriSOq4wyBIOu5LOHXoKHPnERwFnOgDiNBOLX0BW0oNRggaFAm59ywHt4lpJf6dyfn59tln77WOOrVmBD7zv6NTa44W1vO5U2u++Zu74V8ea1datCutjcUzdWrNkVAdG+A+0jPjI0m3bT8Aug7huaKvgruTPNwtJ7HXH5/sdWrNUQqQp1NCvgLwJCbTdvY9xNXV8BYBcED0tuRN0IeslFSdx8asggDwcnQGNtg14AwYgD5NssAkC/sBbxtuxRhfrE3zhzIfLyTYrd8ACaRxgq6VlDTA6+cxQ4tNrDwE7VvxcUQHswQpAFlKdAR4mjh97ZR3QsNyGsGAGSAfAcegdcKlBP3xMY+qN4t+4d4M9r+csFtYuwdgC+D6ogvh3M+ukmQrKOwYH1JE99qV1oahG0PYsrUDPpzkuhNi7LUrrYUWdFHpr0lareTTBjC8zLJScuo8NrJSQimLRQXLlC6H5Wxtmv9sYZnSVvwTKxK8+vYemYF+UVqsrrCUzb8yoi4DKlzDwkGosJalzIxS4ApmVMCZOUZxvuF37Af5BvYmxuLGXwAAAABJRU5ErkJggg==</Image>
   <Url type="text/html" method="GET" 
-       template="http://localhost/cgi-bin/dwww?search={searchTerms}&amp;searchtype=d"/>
-  <moz:SearchForm>http://localhost/dwww/</moz:SearchForm>
+       template="http://dwww/cgi-bin/dwww?search={searchTerms}&amp;searchtype=d"/>
+  <moz:SearchForm>http://dwww/dwww/</moz:SearchForm>
 </OpenSearchDescription>
diff --git dwww/data/swish++.conf dwww/data/swish++.conf
index efcd615..90fde79 100644
--- dwww/data/swish++.conf
+++ dwww/data/swish++.conf
@@ -67,12 +67,19 @@ ExcludeFile		*.gif *.jpg *.png *.tar*
 #	If you know approximately how many files you have, modify the above
 #	value!
 
-FilterFile *.bz2	bunzip2 -c %f > @/var/cache/dwww/swish.tmp.%B
-FilterFile *.gz		gunzip -c %f > @/var/cache/dwww/swish.tmp.%B
-FilterFile *.Z		uncompress -c %f > @/var/cache/dwww/swish.tmp.%B
-#FilterFile *.doc	antiword %f @/var/cache/dwww/swish.tmp.%B.txt
-#FilterFile *.pdf	pdftotext %f @/var/cache/dwww/swish.tmp.%B.txt
-#FilterFile *.ps	pstotext %f > @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.bz2    bunzip2 -c %f > @/var/cache/dwww/swish.tmp.%B
+FilterFile *.gz     gunzip -c %f > @/var/cache/dwww/swish.tmp.%B
+FilterFile *.Z      uncompress -c %f > @/var/cache/dwww/swish.tmp.%B
+FilterFile *.doc    wvText %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.docx   docx2txt.pl %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.xls    ssconvert %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.xlsx   xlsx2csv %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.msg    msgconvert %f --outfile @/var/cache/dwww/swish.tmp.%B.eml
+FilterFile *.eml    formail < %f > @/var/cache/dwww/swish.tmp.%B.mbox
+FilterFile *.mbox   mailexplode < %f > @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.pdf    pdftotext %f @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.ps     pstotext %f > @/var/cache/dwww/swish.tmp.%B.txt
+FilterFile *.html   w3m -T text/html < %f > @/var/cache/dwww/swish.tmp.%B.txt
 
 #
 # used by: index, extract; no option equivalent.
@@ -91,7 +98,7 @@ FilterFile *.Z		uncompress -c %f > @/var/cache/dwww/swish.tmp.%B
 #
 #	Follow symbolic links during indexing or extraction.
 
-IncludeFile text	*.txt *.text 
+IncludeFile text	*.txt *.text *.md
 IncludeFile HTML	*.asp *.*htm* *.jsp
 #IncludeFile ID3	*.mp3
 IncludeFile LaTeX	*.tex
diff --git dwww/data/templates/dwww-convert.dir.start dwww/data/templates/dwww-convert.dir.start
index 176be2a..626eb95 100644
--- dwww/data/templates/dwww-convert.dir.start
+++ dwww/data/templates/dwww-convert.dir.start
@@ -11,6 +11,8 @@
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
  <!-- MENUADD -->
- <div id="men"><p><a href="/dwww/">dwww Home</a>%MENUADD% | <a href="/cgi-bin/dwww?search=%FILEURL%&amp;searchtype=f">Find package</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
 <!-- end dwww-convert.dir.start -->
 
diff --git dwww/data/templates/dwww-convert.start dwww/data/templates/dwww-convert.start
index 97e2ac5..ea660c9 100644
--- dwww/data/templates/dwww-convert.start
+++ dwww/data/templates/dwww-convert.start
@@ -11,6 +11,8 @@
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
  <!-- MENUADD -->
- <div id="men"><p><a href="/dwww/">dwww Home</a>%MENUADD% | <a href="/cgi-bin/dwww?search=%FILEURL%&amp;searchtype=f">Find package</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
  <!-- end dwww-convert.start -->
 
diff --git dwww/data/templates/dwww-find.start dwww/data/templates/dwww-find.start
index 68c167a..f133cbd 100644
--- dwww/data/templates/dwww-find.start
+++ dwww/data/templates/dwww-find.start
@@ -10,16 +10,8 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a></p></div>
- <form method="get" action="/cgi-bin/dwww">
-  <p>
-   <input name="search" size="30" value="%VALUE%">
-   <input type="submit" name="programsubmit" value="Search">
-   <br>
-   <label accesskey="p"><input type="radio" name="searchtype" %PCHECKED% value="p">programs</label>
-   <label accesskey="m"><input type="radio" name="searchtype" %MCHECKED% value="m">menu</label>
-   <label accesskey="d"><input type="radio" name="searchtype" %DCHECKED% value="d">registered docs</label>
-  </p>
- </form>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
 <!-- end dwww-find.start -->
 
diff --git dwww/data/templates/dwww.template dwww/data/templates/dwww.template
index e3c5cc7..20d7d4c 100644
--- dwww/data/templates/dwww.template
+++ dwww/data/templates/dwww.template
@@ -7,30 +7,28 @@
  <meta name="robots" content="noindex,nofollow">
  <title>%TITLE%</title>
  <link rel="stylesheet" type="text/css" href="/dwww/dwww.css">
+ <link rel="search" type="application/opensearchdescription+xml" title="Doxygen search" href="dwww.xml">
 </head>
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
- <div id="men"><p><a href="menu/">Debian Documentation Menu</a>
- | <a href="man/">Manual pages</a>
- | <a href="/cgi-bin/info2www">GNU Info documents</a>
- | <a href="/cgi-bin/dwww/usr/share/doc/?type=dir">/usr/share/doc folders</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </div>
  <form method="get" action="/cgi-bin/dwww" id="docsearch">
   <h3>Find documentation:</h3>
-  <p><input name="search" id="searchfield" size="50" tabindex="0"><input name="programsubmit" value="Search" type="submit"></p>
-  <p>You can search:<br>
-   <label accesskey="p"><input name="searchtype" checked="checked" value="p" type="radio">for a program or package,</label><br>
-   <label accesskey="m"><input name="searchtype" value="m" type="radio">in the Debian Documentation Menu,</label><br>
-   <label accesskey="d"><input name="searchtype" value="d" type="radio">or in registered documentation index.</label>
+  <p>
+   <input name="search" id="searchfield" size="50" tabindex="0">
+   <input name="programsubmit" value="Search" type="submit">
+   <br>
+   <label accesskey="m"><input name="searchtype" value="m" type="radio">Section</label>
+   <label accesskey="d"><input name="searchtype" checked="checked" value="d" type="radio">Document</label>
+  </p>
    <script type="text/javascript">
    <!--
     document.getElementById('searchfield').focus();
    //--></script>
-  </p>
  </form>
  <p class="foot">Generated by <a href="/dwww/"><b>dwww</b></a> version %VERSION% on %DATE%.<br>
- Please read the <a href="/cgi-bin/dwww?search=dwww"><em>on-line documentation</em></a>
- for more details on <b>dwww</b>.<br>
- Send comments, wishes and bug reports using the <a href="%BTSDOCURL%">Debian Bugtracking System</a>.</p>
 </body>
 </html>
 <!-- end dwww.template -->
diff --git dwww/data/templates/man-begins-with.start dwww/data/templates/man-begins-with.start
index fa1b7af..21223dc 100644
--- dwww/data/templates/man-begins-with.start
+++ dwww/data/templates/man-begins-with.start
@@ -10,15 +10,16 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE% - Man pages starting with %LETTER%</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a> | <a href="index.html#%HREFLETTER%">Man pages by name</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
  <form method="get" action="/cgi-bin/dwww">
   <p>
    <input name="search" size="30">
    <input type="submit" name="programsubmit" value="Search">
    <br>
-   <label accesskey="p"><input type="radio" name="searchtype" checked value="p">programs</label>
-   <label accesskey="m"><input type="radio" name="searchtype" value="m">menu</label>
-   <label accesskey="d"><input type="radio" name="searchtype" value="d">registered docs</label>
+   <label accesskey="m"><input name="searchtype" value="m" type="radio">Section</label><br>
+   <label accesskey="d"><input name="searchtype" checked="checked" value="d" type="radio">Document</label><br>
   </p>
  </form>
  <!-- SECTIONS -->
diff --git dwww/data/templates/man-in-section.start dwww/data/templates/man-in-section.start
index 1f3e883..6d76f16 100644
--- dwww/data/templates/man-in-section.start
+++ dwww/data/templates/man-in-section.start
@@ -10,16 +10,17 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a> | <a href="index.html#%HREFSECTION%">Man pages by section</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a> | <a href="index.html#%HREFSECTION%">Man pages by section</a>
+ </p></div>
  <h3>Man pages in section %SECTION%</h3>
  <form method="get" action="/cgi-bin/dwww">
   <p>
    <input name="search" size="30">
    <input type="submit" name="programsubmit" value="Search">
    <br>
-   <label accesskey="p"><input type="radio" name="searchtype" checked value="p">programs</label>
-   <label accesskey="m"><input type="radio" name="searchtype" value="m">menu</label>
-   <label accesskey="d"><input type="radio" name="searchtype" value="d">registered docs</label>
+   <label accesskey="m"><input name="searchtype" value="m" type="radio">Section</label><br>
+   <label accesskey="d"><input name="searchtype" checked="checked" value="d" type="radio">Document</label><br>
   </p>
  </form>
  <!-- LETTERS -->
diff --git dwww/data/templates/man-index.start dwww/data/templates/man-index.start
index 36fa434..4c22396 100644
--- dwww/data/templates/man-index.start
+++ dwww/data/templates/man-index.start
@@ -10,16 +10,17 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE% - Man pages</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a> | <a href="index.html#%HREFSECTION%">Man pages by section</a>
+ </p></div>
  <h3>Man pages index</h3>
  <form method="get" action="/cgi-bin/dwww">
   <p>
    <input name="search" size="30">
    <input type="submit" name="programsubmit" value="Search">
    <br>
-   <label accesskey="p"><input type="radio" name="searchtype" checked value="p">programs</label>
-   <label accesskey="m"><input type="radio" name="searchtype" value="m">menu</label>
-   <label accesskey="d"><input type="radio" name="searchtype" value="d">registered docs</label>
+   <label accesskey="m"><input name="searchtype" value="m" type="radio">Section</label><br>
+   <label accesskey="d"><input name="searchtype" checked="checked" value="d" type="radio">Document</label><br>
   </p>
  </form>
  <h3>Manual pages</h3>
diff --git dwww/data/templates/menu.all.start dwww/data/templates/menu.all.start
index 03fd260..d7aedf6 100644
--- dwww/data/templates/menu.all.start
+++ dwww/data/templates/menu.all.start
@@ -10,17 +10,9 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a> | <a href="/dwww/menu/">Each section in separate page</a></p></div>
- <form method="get" action="/cgi-bin/dwww">
-  <p>
-   <input name="search" size="30">
-   <input type="submit" name="programsubmit" value="Search">
-   <br>
-   <label accesskey="m"><input type="radio" name="searchtype" checked value="m">menu</label>
-   <label accesskey="p"><input type="radio" name="searchtype" value="p">programs</label>
-   <label accesskey="d"><input type="radio" name="searchtype" value="d">registered docs</label>
-  </p>
- </form>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
  <table class="wide">
  <tr>
   <!-- SECTIONLIST -->
diff --git dwww/data/templates/menu.errors.start dwww/data/templates/menu.errors.start
index e5e5d0c..6de50a4 100644
--- dwww/data/templates/menu.errors.start
+++ dwww/data/templates/menu.errors.start
@@ -10,7 +10,9 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE% - List of dwww errors/warnings</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a> | <a href="/dwww/menu/">Each section in separate page</a></p></div>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
  <dl>
  <!-- end menu.errors.start -->
 
diff --git dwww/data/templates/menu.nosections dwww/data/templates/menu.nosections
index a3384a1..a7a452b 100644
--- dwww/data/templates/menu.nosections
+++ dwww/data/templates/menu.nosections
@@ -10,16 +10,10 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a></p></div>
- <form method="get" action="/cgi-bin/dwww">
-  <input name="search" size="30">
-  <input type="submit" name="programsubmit" value="Search">
-  <br>
-  <label accesskey="m"><input type="radio" name="searchtype" checked value="m">menu</label>
-  <label accesskey="p"><input type="radio" name="searchtype" value="p">programs</label>
-  <label accesskey="d"><input type="radio" name="searchtype" value="d">registered docs</label>
- </form>
- <p class="c b">Debian Documentation Menu contains no documents.</p>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
+ <p class="c b">Documentation Menu contains no documents.</p>
  <p class="foot">Generated by <a href="/dwww/"><b>dwww</b></a> version %VERSION% on %DATE%.</p>
 </body>
 </html>
diff --git dwww/data/templates/menu.single.start dwww/data/templates/menu.single.start
index 1232b29..67be321 100644
--- dwww/data/templates/menu.single.start
+++ dwww/data/templates/menu.single.start
@@ -10,17 +10,9 @@
 </head>
 <body>
  <div id="head"><h1>%TITLE%</h1></div>
- <div id="men"><p><a href="/dwww/">dwww Home</a> | <a href="/dwww/menu/all.html">All sections in one page</a></p></div>
- <form method="get" action="/cgi-bin/dwww">
-  <p>
-   <input name="search" size="30">
-   <input type="submit" name="programsubmit" value="Search">
-   <br>
-   <label accesskey="m"><input type="radio" name="searchtype" checked value="m">menu</label>
-   <label accesskey="p"><input type="radio" name="searchtype" value="p">programs</label>
-   <label accesskey="d"><input type="radio" name="searchtype" value="d">registered docs</label>
-  </p>
- </form>
+ <div id="men"><p>
+  <a href="/dwww/">Search</a> | <a href="/dwww/menu/">Sections</a>
+ </p></div>
  <table class="wide">
   <tr>
    <!-- SECTIONLIST -->
diff --git dwww/debian/rules dwww/debian/rules
index af85607..98d3013 100755
--- dwww/debian/rules
+++ dwww/debian/rules
@@ -11,4 +11,4 @@ else
 endif
 
 %:
-	dh "$@" --with apache2
+	dh "$@"
diff --git dwww/perl/Debian/Dwww/Common.pm dwww/perl/Debian/Dwww/Common.pm
index 071948a..39ca115 100644
--- dwww/perl/Debian/Dwww/Common.pm
+++ dwww/perl/Debian/Dwww/Common.pm
@@ -7,6 +7,7 @@ package Debian::Dwww::Common;
 use Exporter();
 use strict;
 
+use File::Basename qw(fileparse);
 use Debian::Dwww::Utils;
 use vars qw(@ISA @EXPORT);
 @ISA = qw(Exporter);
@@ -16,30 +17,35 @@ use vars qw(@ISA @EXPORT);
 my $dwww_url = "/cgi-bin/dwww";
 my %href  = # {{{
     (
-        'debiandoc-sgml'=>   "$dwww_url#FILE#?type=application/sgml",
-        'docbook-xml'   =>   "$dwww_url#FILE#?type=text/xml",
-        'dvi'           =>   "$dwww_url#FILE#?type=application/x-dvi",
-        'html'          =>   "$dwww_url#FILE#?type=html",
+        'debiandoc-sgml'=>   "$dwww_url#FILE#", #?type=application/sgml
+        'docbook-xml'   =>   "$dwww_url#FILE#", #?type=text/xml
+        'doc'           =>   "$dwww_url#FILE#", #?type=application/msword
+        'docx'          =>   "$dwww_url#FILE#", #?type=application/vnd.openxmlformats-officedocument.wordprocessingml.document
+        'dvi'           =>   "$dwww_url#FILE#", #?type=application/x-dvi
+        'html'          =>   "$dwww_url#FILE#", #?type=html
         'info'          =>   "/cgi-bin/info2www?file=",
-        'latex'         =>   "$dwww_url#FILE#?type=application/x-latex",
-        'linuxdoc-sgml' =>   "$dwww_url#FILE#?type=application/sgml",
-        'pdf'           =>   "$dwww_url#FILE#?type=application/pdf",
-        'postscript'    =>   "$dwww_url#FILE#?type=application/postscript",
-        'ps'            =>   "$dwww_url#FILE#?type=application/postscriptps",
-        'rtf'           =>   "$dwww_url#FILE#?type=text/rtf",
-        'sgml'          =>   "$dwww_url#FILE#?type=application/sgml",
-        'tar'           =>   "$dwww_url#FILE#?type=application/tar",
-        'texinfo'       =>   "$dwww_url#FILE#?type=application/x-texinfo",
+        'latex'         =>   "$dwww_url#FILE#", #?type=application/x-latex
+        'linuxdoc-sgml' =>   "$dwww_url#FILE#", #?type=application/sgml
+        'msg'           =>   "$dwww_url#FILE#",
+        'pdf'           =>   "$dwww_url#FILE#", #?type=application/pdf
+        'postscript'    =>   "$dwww_url#FILE#", #?type=application/postscript
+        'ps'            =>   "$dwww_url#FILE#", #?type=application/postscriptps
+        'rtf'           =>   "$dwww_url#FILE#", #?type=text/rtf
+        'sgml'          =>   "$dwww_url#FILE#", #?type=application/sgml
+        'tar'           =>   "$dwww_url#FILE#", #?type=application/tar
+        'texinfo'       =>   "$dwww_url#FILE#", #?type=application/x-texinfo
+        'xls'           =>   "$dwww_url#FILE#", #?type=application/vnd.ms-excel
+        'xlsx'          =>   "$dwww_url#FILE#", #?type=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
         'dwww-url'      =>   "",
-        'text'          =>   "$dwww_url#FILE#?type=text/plain",
+        'text'          =>   "$dwww_url#FILE#", #?type=text/plain
         'pkgsearch'     =>   "$dwww_url?search=",
-        "man"           =>   "$dwww_url#FILE#?type=man", 
+        "man"           =>   "$dwww_url#FILE#?type=man",
         "runman"        =>   "$dwww_url?type=runman&amp;location=",
         'doc-base'      =>   "$dwww_url?search=#FILE#&amp;searchtype=b",
-        "dir"           =>   "$dwww_url#FILE#/?type=dir",
+        "dir"           =>   "$dwww_url#FILE#?type=dir",
         "info"          =>   "/cgi-bin/info2www?file=",
         "file"          =>   "$dwww_url",
-        "menu"          =>   "/dwww/menu/",
+        "menu"          =>   "/dwww/menu/#FILE#",
         "search"        =>   "$dwww_url?search=",
         "dpkg"          =>   "/cgi-bin/dpkg?query=",
 
@@ -57,7 +63,9 @@ sub GetURL{ # {{{
     if ($href{$format_name} =~ /#FILE#/) {
         return $` . $format_url . $';
     } else {
-        return $href{$format_name} . $format_url;
+        die caller if $format_url =~ /^s.*\.html$/;
+        local @_ = fileparse($format_url, keys %href);
+        return join ':', $ENV{'HTTPS'} eq "on" ? "https" : "http", "//$ENV{'SERVER_NAME'}", "$ENV{'SERVER_PORT'}" . $_[1] . $_[0] . $_[2] . "\n\n"
     }
 
 
diff --git dwww/perl/Debian/Dwww/Utils.pm dwww/perl/Debian/Dwww/Utils.pm
index 05250ae..63445aa 100644
--- dwww/perl/Debian/Dwww/Utils.pm
+++ dwww/perl/Debian/Dwww/Utils.pm
@@ -242,21 +242,13 @@ sub CheckAccess() { # {{{
 
     # if we're here, the file either does not exist
     # or does not match any @dwww_docpath
-    my $ok          = 0;
     my $strip_file  = &StripDirs( $file );
     foreach my $path  (@$dwww_docpath)  {
         if ( -d $path ) {
             $path = &StripDirs( $path );
             if (substr($strip_file, 0, length($path)) eq $path) {
-                $ok = 1;
-                last;
-            }
-        }
-    }
-
-
     # if file exists, check if it's in allowed_linkpath
-    if ( $exists_f && $ok ) {
+    if ( $exists_f ) {
         foreach my $path (@$dwww_allowedlinkpath) {
             if ( -d $path ) {
                 $path = &realpath( $path );
@@ -265,19 +257,20 @@ sub CheckAccess() { # {{{
                 }
             }
         }
-    }
-
-    # file either does not exist or is not allowed to show
-    # print suitable error message
-    if ( !$exists_f && $ok ) {
+    } else {
         &ErrorMsg ("404 File not found",
                    "File not found" ,
                    "dwww could not find the file $orig_file" );
-    } else {
-        &ErrorMsg ("403 Access denied",
-                    "Access denied",
-                    "dwww will not allow you to read the file $orig_file" );
     }
+                last;
+            }
+        }
+    }
+
+    # file either does not exist or is not allowed to show
+    &ErrorMsg ("403 Access denied",
+                "Access denied",
+                "dwww will not allow you to read the file $orig_file" );
 
     exit 1; ### UNREACHED ###
 } # }}}
diff --git dwww/scripts/dwww-build dwww/scripts/dwww-build
index 5cc8a20..fd91b2b 100755
--- dwww/scripts/dwww-build
+++ dwww/scripts/dwww-build
@@ -110,6 +110,8 @@ print "  g) copying files... ";
 
 # kv5r mod: copy the css file:
 &copy("$dwww_lib_dir/dwww.css", $tgttmp);
+&copy("$dwww_lib_dir/dwww.svg", $tgttmp);
+&copy("$dwww_lib_dir/dwww.xml", $tgttmp);
 &append_user_css("/etc/dwww/dwww-user.css", "$tgttmp/dwww.css");
 
 
@@ -597,8 +599,10 @@ sub man_index() { # {{{
 sub make_front_page() { # {{{
     open M, ">$tgttmp/index.html" or die "Cannot open file $tgttmp/index.html: $!";
     print M &TemplateFile($template_index_main,
-                { 'TITLE' => $conf->{'DWWW_TITLE'},
-                              'BTSDOCURL' => &GetBTSDocUrl()
+                {
+                	'TITLE' => $conf->{'DWWW_TITLE'},
+                	'BTSDOCURL' => &GetBTSDocUrl(),
+                	'DOCPATH'     => + ( @{$conf->{DWWW_DOCPATH}})[3]
                 });
     close M;
 } # }}}
diff --git dwww/scripts/dwww-build-menu dwww/scripts/dwww-build-menu
index ed38ee1..c1b3a4b 100755
--- dwww/scripts/dwww-build-menu
+++ dwww/scripts/dwww-build-menu
@@ -68,9 +68,14 @@ my @known_formats=(
     'rtf',
     'debiandoc-sgml',
     'docbook-xml',
+    'doc',
+    'docx',
+    'xls',
+    'xlsx',
     'dvi',
     'latex',
     'linuxdoc-sgml',
+    'msg',
     'pdf',
     'postscript',
     'ps',
@@ -111,12 +116,12 @@ $ErrorProc = \&ErrorHandle;
 
 &CreateIndex;
 
+print ERRFILE &TemplateFile($template_error_end, {});
+close ERRFILE;
 
 &rmtree($out_dir);
 &RenameDir($out_dir_tmp, $out_dir);
 
-print ERRFILE &TemplateFile($template_error_end, {});
-close ERRFILE;
 exit (0);
 
 #########################################################################
@@ -228,7 +233,7 @@ sub AddNewEntry() { # {{{
                 $doc_entry->{'frm_name_' . $known} = $f;
                 $doc_entry->{'frm_file_' . $known} = $w;
                 $known++;
-            } elsif (glob($w)) {
+            } elsif (() = glob($w)) {
                 $files{$w} = '1';
                 $doc_entry->{'frm_name_' . $known} = $doc_base_fmt;
                 $doc_entry->{'frm_file_' . $known} = $f . '/' . $entry->{'document'};
diff --git dwww/scripts/dwww-find dwww/scripts/dwww-find
index 48cd0d3..de1b0be 100755
--- dwww/scripts/dwww-find
+++ dwww/scripts/dwww-find
@@ -557,7 +557,7 @@ sub SearchMenus { # {{{
     my @patterns   = @_;
     my $match_cnt  = 0;
 
-    print "<h2>Menu entries related to <em>" . &HTMLEncode("$searchfor") . "</em></h2>\n";
+    #print "<h2>Menu entries related to <em>" . &HTMLEncode("$searchfor") . "</em></h2>\n";
 
     if (not opendir DOCBASEDIR, $dir) {
         print "Can't open directory $dir: $!\n";
diff --git dwww/scripts/dwww-index++ dwww/scripts/dwww-index++
index 1e49350..d181f07 100755
--- dwww/scripts/dwww-index++
+++ dwww/scripts/dwww-index++
@@ -37,6 +37,13 @@ $| = 1;
 
 # Global variables
 my @index_formats=(
+    'pdf',
+    'md',
+    'msg',
+    'xls',
+    'xlsx',
+    'doc',
+    'docx',
 	'html',
 	'text',
 	'rtf',
@@ -46,14 +53,14 @@ my @index_formats=(
 # files we never index, checked before stat() call
 my $stopfiles = qr(\.(css|dsl|ico|gif|jpe?g|lfig|mp[34]|sasl|png|svg)$)o;
 # files we actually index, after stat() call
-my $indexfiles = qr(\.([sx]?html?|te?xt?|rtf|[ja]sp|[1-9n][^\.]*)(\.gz|\.bz2|\.Z)?$)o;
+my $indexfiles = qr(\.([sx]?html?|te?xt?|doc|pdf|md|msg|docx|xls|xlsx|rtf|[ja]sp|[1-9n][^\.]*)(\.gz|\.bz2|\.Z)?$)o;
 
 my $dwww_url 				= "/cgi-bin/dwww";
 my $dwww_swish_conf   	  	= "/usr/share/dwww/swish++.conf";
 my $dwww_swish_index  	  	= "/var/cache/dwww/dwww.swish++.index";
 my $dwww_indexed_files_db	= "/var/cache/dwww/index.files.db";
 my $dwww_lastrun_info		= "/var/cache/dwww/index.runinfo";
-my $path_to_index			= '/usr/bin/index++';
+my $path_to_index			= 'index++';
 my $MAX_RECURS_SUBDIRS_LVL  = 10;
 
 our($opt_v, $opt_f, $opt_i, $opt_l);				# set by getopt
@@ -63,12 +70,6 @@ my $RUN_MODE_SKIP			= 0;
 my $RUN_MODE_FULL 			= 1;
 my $RUN_MODE_INCREMENTAL 	= 2;
 
-if (! -x $path_to_index) {
-	&Inform( "Cannot find index++ command.\n" .
-			 "Do you have swish++ package installed?", 1);
-	exit(1);
-}
-
 my $dwwwconf   		= &DwwwInitialize("/etc/dwww/dwww.conf");
 &DwwwSetupDirs($dwwwconf);
 
diff --git dwww/scripts/dwww-refresh-cache dwww/scripts/dwww-refresh-cache
index 93cecfa..95e404b 100755
--- dwww/scripts/dwww-refresh-cache
+++ dwww/scripts/dwww-refresh-cache
@@ -5,8 +5,6 @@
 #
 # Part of the dwww package.  Written by Robert Luberda.
 
-set -e
-
 . /usr/share/dwww/functions.sh && dwww_initialize  || exit 1
 
 export PATH=.:$PATH
@@ -42,7 +40,7 @@ if [ -n "$DWWW_KEEPDAYS" ] ; then
                 -type f -print0 | xargs -0 rm -f
         echo done
 
-        su -s /bin/sh "$DWWW_CGIUSER" -c '/usr/sbin/dwww-cache --clean' < /dev/null || true
+        /usr/sbin/dwww-cache --clean
 
 fi
 
diff --git dwww/scripts/dwww.cgi dwww/scripts/dwww.cgi
index dc0a6e4..5962734 100755
--- dwww/scripts/dwww.cgi
+++ dwww/scripts/dwww.cgi
@@ -1,4 +1,4 @@
-#!/usr/bin/perl -T
+#!/usr/bin/perl
 # vim:ft=perl:cindent:ts=4:sts=4:sw=4:et:fdm=marker:cms=\ #\ %s
 #
 #              IF YOU SEE THIS TEXT
@@ -8,6 +8,7 @@
 #
 # $Id: dwww.cgi 547 2011-01-15 15:29:55Z robert $
 #
+use Debian::Dwww::Common;
 
 $doc2html       = '/usr/sbin/dwww-convert'; # Document-to-HTML converter
 $search2html    = '/usr/sbin/dwww-find';    # Search and output results as HTML
@@ -48,7 +49,6 @@ if ($in{'search'} ne '') {
 else {
         $search   = $FALSE;
         $type     = $in{'type'};     # This document is formated in $type.
-        $type     = 'file' unless defined $type;
         $location = $in{'location'}; # It is located at $location.
         $no_pi    = '--no-path-info';
         if ($location eq "") {
@@ -78,13 +78,15 @@ if ($search == $TRUE) {
     &error($TRUE, "Couldn't search for @searchstring! ($!)");
 }
 
-elsif (($type eq "") or ($location eq "")) {
+elsif (not $location) {
     my $port     = $ENV{'SERVER_PORT'} ? ':' . $ENV{'SERVER_PORT'} : '';
     my $protocol = ($ENV{'HTTPS'} and $ENV{'HTTPS'} eq "on") ? "https" : "http";
 
-
     print "Location: $protocol://$ENV{'SERVER_NAME'}$port/dwww/\n\n";
+}
 
+elsif (not $type) {
+    print "Location: " . GetURL(undef, $location);
 }
 
 else {
diff --git dwww/src/dwww-txt2html.c dwww/src/dwww-txt2html.c
index 2c6cd98..3afb4d3 100644
--- dwww/src/dwww-txt2html.c
+++ dwww/src/dwww-txt2html.c
@@ -29,7 +29,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include <publib.h>
-#include <values.h>
+#include <limits.h>
 
 #include "utils.h"
 
-- 
2.20.1

